<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Journeys</title>
  <link href="https://fonts.googleapis.com/css?family=Hind+Siliguri&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap" rel="stylesheet">
  <link href="css/perfect-scrollbar.css" rel="stylesheet">        
  <link rel="shortcut icon" href="assets/img/nglogo.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css?family=Buenard|Lustria|Vollkorn&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <style>
    html {
    -moz-osx-font-smoothing: grayscale;
    -webkit-font-smoothing: antialiased;
    font-smoothing: antialiased;
    font-weight: 400;
    font-weight: 300;
    }

    @-moz-document url-prefix() {
        body {
            font-weight: lighter !important;
        }
    }
    
    html,
    body{
      position: fixed;
      width: 100%;
      height: 100vh;
      margin: 0;
      background: rgba(82, 87, 96,0.7);
      color:white;
      overflow: hidden
    }

    svg{
      position: fixed;
    }

    .land {
      fill: rgb(255, 255, 255);
      stroke-opacity: 1;
    }

    .countries path {
      stroke: rgba(0, 0, 0, .2);
      stroke-linejoin: round;
      stroke-width: 1.5;
      fill-opacity: 1;
      stroke-dasharray: 4;
    }

    .countryTooltip {
      position: absolute;
      display: none;
      pointer-events: none;
      background: #fff;
      padding: 5px;
      text-align: left;
      border: solid #ccc 1px;
      color: #666;
      font-size: 14px;
      font-family: sans-serif;
      font-size:18px;
      font-family: 'Roboto Condensed', sans-serif !important;
    }

    .graticule {
      fill: none;
      stroke: black;
      stroke-width: .5;
      opacity: .2;
    }

    .labels {
      font-family: 'Roboto Condensed', sans-serif !important;
      fill: black;
      opacity: .5;
      font-weight:300;
    }

    .noclicks {
      pointer-events: none;
    }

    .point {
      opacity: 0.6; 
    }
    .line {
      stroke-linejoin: round;
      stroke-width: 4;
      fill-opacity: 0;
      stroke-dasharray:4 1 2;
    }

    .arcs {
      opacity: .1;
      stroke: gray;
      stroke-width: 3;
    }

    .flyers {
      stroke-width: 1;
      opacity: .6;
      stroke: darkred;
    }

    .arc,
    .flyer {
      stroke-linejoin: round;
      fill: none;
    }

    .arc {}

    .flyer {}

    .flyer:hover {}
    
    body{
        height:100%;
        width:100%;
    }
    
    div.but{
      width:420px;
      /*margin:auto;*/
    }


    div#but-text{
      position:relative;
      display:inline-block;
      left:120px;
      width:320px;
      margin-bottom:15px;
    }

    div.title{
        height:100%;
        display:block;
    }

    div#mainMenu{
        position:absolute;
        margin:auto;
        display:inline-block;
        width:50%;
        left:10px;
        top:25px;
        z-index:1000;
        height:100%;
        margin-top:40px;
        /*transform: translate(-50%, -50%);
        left: 50%;
        top: 50%;*/
    }
    
    div#text{
        height:95%;
        width:70%;
        position:relative;
        overflow: hidden;
        margin-left:20px;
    }

    h1{
      font-family: 'Roboto Condensed', sans-serif !important;
        font-variant: small-caps;
        font-weight:bold;
        font-size:90px;
        text-align:left;
        line-height:125px;
        margin:auto;
        display:block;
        letter-spacing: 2px;
      }

    h2{
      font-family: 'Roboto Condensed', sans-serif !important;
        font-variant: small-caps;
        font-weight:bold;
        font-size:105px;
        text-align:left;
        line-height:125px;
    }

    p{
      margin:0;
      font-family: 'Roboto Condensed', sans-serif !important;
    }

    p#but-a{
        font-size:34px;
        font-family: 'Roboto Condensed', sans-serif !important;
        font-variant: small-caps;
        border:none;
        text-decoration:none;
        color:white;
        text-align:left;
        font-weight:bold;
    }
    p#desc{
      font-family: 'Roboto Condensed', sans-serif !important;
      font-weight:300 !important;
      font-size:18px;
      color:white;
    }

    p:hover{
      text-decoration:none;
    }

    p.intro-text{
        font-weight:300;
        font-size:22px;
        width:400px;
        line-height:22px;
    }

    p.about-text{
        font-weight:300;
        font-size:18px;
        width:400px;
        line-height:22px;
    }

    p.cont-text{
      font-size:25px;
      font-weight:300;
    }

    img.icon{
      height:60px;
      width:60px;
      filter: invert(100%);
      display:inline-block;
      position:absolute;
      margin-top:20px;
      margin-left:10px;
    }
    a{
      color: white;
      font-weight:300;
      text-decoration:none;
      font-family: 'Roboto Condensed', sans-serif !important;
    }
    a:visited {
      color: white;
    }
    a.underlined{
      text-decoration:underline;
    }
    ul.a {
      list-style-type: circle;
    }
    ul.b {
      list-style-type: square;
    }
    li{
      font-size:24px;
      font-weight:300;
    }
    li.b{
      font-size:18px;
      font-weight:300;
    }
    div.bottom-arrow{
        color: white;
        background: #61666E;
        width:500px;
        height:50px;
        position:absolute;
        bottom:0;
        left:0;
        z-index:1000;
    }
    /* i{
      margin-top:10px;
      font-size: 30px !important;
      left: 200px;
      position: absolute;
    } */
    div.navBar{
      height:35px;
      width:100%;
      background:#525760;
      position:absolute;
      left:0;
      top:0;
      z-index:1000;
    }
    a.back{
      margin-left:10px;
      margin-top:3px;
      font-size:20px;
      font-weight:normal;
      position:absolute;
      letter-spacing: 1px;
      font-family: 'Roboto Condensed', sans-serif !important;
    }
    a.back:hover{
      cursor:pointer;
      color:lightgray;
      text-decoration:none;
    }

    a.home{
      text-align:center;
      margin-top:3px;
      font-size:20px;
      font-weight:bold;
      position:absolute;
      font-variant: small-caps;
      left:3%;
      font-family: 'Roboto Condensed', sans-serif !important;
    }
    a.home:hover{
      cursor:pointer;
      color:lightgray;
      text-decoration:none;
    }
    a.github{
      text-align:center;
      margin-top:3px;
      font-size:20px;
      font-weight:bold;
      position:absolute;
      color:white;
      font-variant: small-caps;
      right:1%;
      text-decoration:none;
    }
    a.github:hover{
      cursor:pointer;
      color:lightgray;
      text-decoration:none;
    }
    a.fb{
    text-align:center;
    margin-top:3px;
    font-size:20px;
    font-weight:bold;
    position:absolute;
    color:white;
    font-variant: small-caps;
    right:2.5%;
    text-decoration:none;
    }
a.fb:hover{
    cursor:pointer;
    color:lightgray;
    text-decoration:none;
    }
a.tw{
        text-align:center;
        margin-top:3px;
        font-size:20px;
        font-weight:bold;
        position:absolute;
        color:white;
        font-variant: small-caps;
        right:3.5%;
        text-decoration:none;
        }
a.tw:hover{
        cursor:pointer;
        color:lightgray;
        text-decoration:none;
        }
  </style>
</head>

<body>
<div class="navBar">
  <a href="index.html" class="back"><i class="fa fa-chevron-left"></i></a>
  <a href="index.html" class="home">Global Refugee Atlas</a>
  <a href="https://facebook.com" target="_blank" class="fb"><i class="fa fa-facebook"></i></a>
  <a href="https://twitter.com" target="_blank" class="tw"><i class="fa fa-twitter"></i></a>
  <a href="https://github.com/jakobzhao/refugee" target="_blank" class="github"><i class="fa fa-github"></i></a>
</div>
<div class="row">
  <div id ="mainMenu" class="col-md-5">
    <div id = "text">
      <h1>Journeys</h1>
      <p id="desc" style="margin-bottom:50px; margin-top:20px;">This Chapter describes the journeys of refugees both on a global and local scale. The first section shows refugee flows from origin countries to host countries and viceversa. The other two sections use storymaps to narrate individual journeys of refugees seeking safety away from home. </p>    
      <div style="margin-bottom:100px;">
      <a href="origin.html">
        <div class="but" id="but1">
          <img src="assets/img/flow_icon.png" class="icon">
          <div id="but-text">
            <p style="display:block;" id="but-a">Flow</p>
            <p id="desc">Origins and Destinations of refugees<br> for every country in the world</p>
          </div>
        </div>
      </a> 
      <br/>
      <a href="journeys/index.html" onmouseover="selectType(100)" onmouseout="resetRoutes()" >
        <div class="but" id="but2">
          <img src="assets/img/journey1_icon.png" class="icon">
          <div id="but-text">
            <p id="but-a" style="display:block;">Escaping Burundi</p>
            <p id="desc">Fleeing pre-election violence, three <br>families reach safety in Rwanda</p>
          </div>
        </div>
      </a>  
      <a href="journeys/index2.html" onmouseover="selectType(100)" onmouseout="resetRoutes()" >
        <div class="but" id="but3">
          <img src="assets/img/journey2_icon.png" class="icon">
          <div id="but-text">
            <p id="but-a" style="display:block;">Amina</p>
            <p id="desc">A Somali mother with her teenage <br>sons on an horrific journey to safety</p>
          </div>
        </div>
      </a>  
      </div>
    </div>
  </div> 
  <!-- <div class="bottom-arrow"><i class="animated zoomIn infinite fa fa-chevron-down arrow-chevron-down"></i></div> -->
  <div class="col-md-7">
    <svg>
      <defs>
        <radialGradient cx="75%" cy="25%" id="ocean_fill">
          <stop offset="5%" stop-color="#ddf" />
          <stop offset="100%" stop-color="#9ab" />
        </radialGradient>
        <radialGradient cx="75%" cy="25%" id="globe_highlight">
          <stop offset="5%" stop-color="#fff" stop-opacity="0.6" />
          <stop offset="100%" stop-color="#808080" stop-opacity="0.2" />
        </radialGradient>
        <radialGradient cx="50%" cy="40%" id="globe_shading">
          <stop offset="50%" stop-color="#ffffff" stop-opacity="0" />
          <stop offset="100%" stop-color="#808080" stop-opacity="0.3" />
        </radialGradient>
        <radialGradient cx="50%" cy="50%" id="drop_shadow">
          <stop offset="20%" stop-color="#000" stop-opacity="0.5" />
          <stop offset="100%" stop-color="#000" stop-opacity="0" />
        </radialGradient>
      </defs>
    </svg>
  </div>
</div> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <!-- Use d3-fetch instead of d3-request in ES6 -->
  <script src="https://d3js.org/d3-request.v1.min.js"></script>
  <script src="https://d3js.org/d3-queue.v3.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src="js/perfect-scrollbar.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

  <script>
      	$(function() {
  		$('#but1').hover(function() {
          $('#but1').css('background-image', 'url("assets/img/flow_background.png")');
        }, function() {
          $('#but1').css('background-image', 'initial');
        });
    });
    $(function() {
        $('#but2').hover(function() {
          $('#but2').css('background-image', 'url("assets/img/journey_background.png")');
        }, function() {
          $('#but2').css('background-image', 'initial');
        });
    });
    $(function() {
        $('#but3').hover(function() {
          $('#but3').css('background-image', 'url("assets/img/journey1_background.png")');
        }, function() {
          $('#but3').css('background-image', 'initial');
        });
    });
      
      d3.select(window).on("resize", sizeChange);
      
      const config = {
      speed: 0.005,
      verticalTilt: -30,
      horizontalTilt: 0
    };

    const ps = new PerfectScrollbar('#text', {
      wheelSpeed: 2,
      wheelPropagation: true,
      minScrollbarLength: 20
    });

    var width = window.innerWidth,
      height = window.innerHeight,
      sensitivity = 0.25,
      offsetX = width / 1.1,
      offsetY = height / 2,
      maxElevation = 45,
      initRotation = [0, -30],
      scaleExtent = [1, 2],
      flyerAltitude = 80,
      countryTooltip = d3.select("body").append("div").attr("class", "countryTooltip"),
      countryById = {},
      countries,
      routePaths,
      routeCentroids = {},
      proj = 0,
      currentPos = initRotation;

    var radius = width / 3;
    if (height < width) {
      radius = height /1.3;
    }

    var projection = d3
      .geoOrthographic()
      .scale(radius)
      .rotate(initRotation)
      .translate([offsetX, offsetY])
      .clipAngle(90);
    var skyProjection = d3
      .geoOrthographic()
      .scale(radius + flyerAltitude)
      .rotate(initRotation)
      .translate([offsetX, offsetY])
      .clipAngle(90);
    var path = d3
      .geoPath()
      .projection(projection)
      .pointRadius(0.5);
    var swoosh = d3.line()
      .x(function(d) {
        return d[0]
      })
      .y(function(d) {
        return d[1]
      })
      .curve(d3.curveBasis);
    var graticule = d3.geoGraticule();

    var svg = d3
      .select("svg")
      .attr("width", width)
      .attr("height", height)
      .attr("transform-origin", offsetX + "px " + offsetY + "px")
      .call(
        d3
        .drag()
        .subject(function() {
          var r = projection.rotate();
          return {
            x: r[0] / sensitivity,
            y: -r[1] / sensitivity
          };
        })
        .on("drag", dragged)
      )
      /*.call(
        d3
        .zoom()
        .scaleExtent(scaleExtent)
        .on("zoom", zoomed)
      )*/
      .on("dblclick.zoom", null);

    var labels;

    d3.queue()
      .defer(d3.json, "https://raw.githubusercontent.com/d3/d3.github.com/master/world-110m.v1.json")
      .defer(d3.json, "assets/map_data/global/cities.json")
      .defer(d3.json, "assets/map_data/global/links.json")
      .defer(d3.csv, "assets/map_data/global/country_names.csv")
      .defer(d3.csv, "assets/map_data/global/demographics.csv")
      .defer(d3.json, "assets/map_data/global/camps.json")
      .defer(d3.json, "assets/map_data/global/settlements.json")
      .defer(d3.json, "assets/map_data/global/dispersed.json")
      .defer(d3.json, "assets/map_data/global/routes.json")
      .await(ready);

function ready(error, world, places, links, countryNames, demographics, camps, settlements, dispersed, routes) {

      
var defs = svg.append("defs");

var filter = svg.append("defs")
  .append("filter")
  .attr("id", "drop-shadow")
  .attr("height", "110%");
filter.append("feGaussianBlur")
  .attr("in", "SourceAlpha")
  .attr("stdDeviation", 0.5)
  .attr("result", "blur");

filter.append("feOffset")
  .attr("in", "blur")
  .attr("dx", 1)
  .attr("dy", 1)
  .attr("result", "offsetBlur");

  var feMerge = filter.append("feMerge");

feMerge.append("feMergeNode")
    .attr("in", "offsetBlur")
feMerge.append("feMergeNode")
    .attr("in", "SourceGraphic");
    
var gradient = svg.append("svg:defs")
  .append("svg:linearGradient")
    .attr("id", "gradient")
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "0%")
    .attr("y2", "100%")
    .attr("spreadMethod", "pad");

gradient.append("svg:stop")
    .attr("offset", "0%")
    .attr("stop-color", "#d9d9d9")
    .attr("stop-opacity", 1);

gradient.append("svg:stop")
    .attr("offset", "100%")
    .attr("stop-color", "#b3b3b3")
    .attr("stop-opacity", 1);

  countries = topojson.feature(world, world.objects.countries).features;
  routePaths = routes.features;

  countryNames.forEach(function(d) {
    countryById[d.iso_n3] = d.name;
  });

  svg
    .append("ellipse")
    .attr("cx", offsetX - 40)
    .attr("cy", offsetY + radius - 20)
    .attr("rx", projection.scale() * 0.9)
    .attr("ry", projection.scale() * 0.25)
    .attr("class", "noclicks")
    .style("fill", "url(#drop_shadow)");
  svg
    .append("circle")
    .attr("cx", offsetX)
    .attr("cy", offsetY)
    .attr("r", projection.scale())
    .attr("class", "noclicks")
    .style("fill", "#ffffff");
  svg
    .append("path")
    .datum(topojson.feature(world, world.objects.land))
    .attr("class", "land")
    .attr("d", path)
    .style("filter", "url(#drop-shadow)");
  svg
    .append("path")
    .datum(graticule)
    .attr("class", "graticule noclicks")
    .attr("d", path);
  svg
    .append("circle")
    .attr("cx", offsetX)
    .attr("cy", offsetY)
    .attr("r", projection.scale())
    .attr("class", "noclicks")
    .style("fill", "url(#globe_highlight)");
  svg
    .append("circle")
    .attr("cx", offsetX)
    .attr("cy", offsetY)
    .attr("r", projection.scale())
    .attr("class", "noclicks")
    .style("fill", "url(#globe_shading)");
  svg
    .append("g")
    .attr("class", "countries")
    .selectAll("path")
    .data(countries, function(d){
            //countryCentroids[d.id] = d3.geoCentroid(d);
        })
    .enter()
    .append("path")
    .attr("d", path)
    .attr("name",function(d){
       return countryById[d.id];
    })
    .attr("fill", function (d) {
        return "#c8cad0";
    })
    .attr("box-shadow", 'inset 0 0 10px #000000');
  svg
    .append("g")
    .attr("class", "points")
    .selectAll(".point")
    .data(places.features)
    .enter()
    .append("path")
    .attr("class", "point")
    .attr("opacity", 0.6)
    .attr("d", path.pointRadius(3));
  svg
    .append("g")
    .attr("class", "labels")
    .selectAll(".label")
    .data(places.features)
    .enter()
    .append("text")
    .attr("class", "label")
    .text(function(d) {
      return d.properties.NAME;
    });

  position_labels();
  //enableRotation();

  svg
    .append("g")
    .attr("class", "lines")
    .selectAll(".lines")
    .data(routePaths)
    .enter()
    .append("path")
    .attr("d", path)
    .attr("class", "line")
    .attr("stroke", "rgba(153, 51, 51, 1");
        
}
    
    function selectType(id){        
        var rotate = projection.rotate(),
            focusedRoute = route(routePaths, id),
            p = d3.geoCentroid(focusedRoute);

        svg.selectAll(".line")
          .filter(function(d) {
          /*countryTooltip.text(countryById[d.id])
            .style("left", (d3.event.pageX + 7) + "px")
            .style("top", (d3.event.pageY - 15) + "px")
            .style("display", "block")
            .style("opacity", 1);*/
            if (d.properties.id == id)
                return true;
          })
          .attr("stroke", "rgba(0, 0, 0, 1");
          
        svg.selectAll(".line")
          .filter(function(d) {
            if (d.properties.id != id)
                return true;
          })
          .attr("stroke", "rgba(153, 51, 51, 0.2");
          
      svg.selectAll(".focused").classed("focused", focused = false);

        (function transition() {
          d3.transition()
          .duration(2500)
          .tween("rotate", function() {
            var r = d3.interpolate(projection.rotate(), [-p[0], -p[1]]);
            return function(t) {
              projection.rotate(r(t));
              position_labels();
              svg.selectAll("path").attr("d", path)
              .classed("focused", function(d, i) { return d.id == focusedRoute.id ? focused = d : false; });
            };
          })
          })();

        function route(cnt, sel) { 
          for(var i = 0, l = cnt.length; i < l; i++) {
            if(cnt[i].properties.id == sel) {return cnt[i];}
          }
        };
    }

    function resetRoutes(){
      svg.selectAll(".line")
          .attr("stroke", "rgba(153, 51, 51, 1");
    }

    function enableRotation() {
      d3.timer(function(elapsed) {
        projection.rotate([config.speed * elapsed - 120, config.verticalTilt, config.horizontalTilt]);
        svg.selectAll("path").attr("d", path);
         position_labels();
      });
    }

    function endRotation() {

    }

    function position_labels() {
      var centerPos = projection.invert([offsetX, offsetY]);
      svg
        .selectAll(".label")
        .attr("text-anchor", function(d) {
          var x = projection(d.geometry.coordinates)[0];
          return x < offsetX - 20 ? "end" : x < offsetX + 20 ? "middle" : "start";
        })
        .attr("transform", function(d) {
          var loc = projection(d.geometry.coordinates),
            x = loc[0],
            y = loc[1];
          var offset = x < offsetX ? -5 : 5;
          return "translate(" + (x + offset) + "," + (y - 2) + ")";
        })
        .style("display", function(d) {
          var d = d3.geoDistance(d.geometry.coordinates, centerPos);
          return d > 1.57 ? "none" : "inline";
        });
    }

    function flying_arc(pts) {
      var source = pts.geometry.coordinates[0],
        target = pts.geometry.coordinates[1];
      var mid1 = location_along_arc(source, target, .333);
      var mid2 = location_along_arc(source, target, .667);
      var result = [projection(source),
        skyProjection(mid1),
        skyProjection(mid2),
        projection(target)
      ]
      // console.log(result);
      return result;
    }

    function fade_at_edge(d) {
      var centerPos = projection.invert([offsetX, offsetY]);
      start = d.geometry.coordinates[0];
      end = d.geometry.coordinates[1];
      var start_dist = 1.57 - d3.geoDistance(start, centerPos),
        end_dist = 1.57 - d3.geoDistance(end, centerPos);
      var fade = d3.scaleLinear().domain([-.1, 0]).range([0, .1])
      var dist = start_dist < end_dist ? start_dist : end_dist;
      return fade(dist)
    }

    function location_along_arc(start, end, loc) {
      var interpolator = d3.geoInterpolate(start, end);
      return interpolator(loc)
    }

    function dragged() {
      var o1 = [d3.event.x * sensitivity, -d3.event.y * sensitivity];
      o1[1] =
        o1[1] > maxElevation ?
        maxElevation :
        o1[1] < -maxElevation ?
        -maxElevation :
        o1[1];
        currentPos = o1;
      projection.rotate(o1);
      skyProjection.rotate(o1);
      refresh();
    }

    function zoomed() {
      if (d3.event) {
        svg.attr("transform", "scale(" + d3.event.transform.k + ")");
      }
    }

    function refresh() {
      svg.selectAll(".land").attr("d", path);
      svg.selectAll(".countries path").attr("d", path);
      svg.selectAll(".graticule").attr("d", path);
      refreshLandmarks();
      refreshFlyers();
    }

    function refreshLandmarks() {
      svg.selectAll(".point").attr("d", path);
      svg.selectAll(".line").attr("d", path);
      position_labels();
    }

    function refreshFlyers() {
      svg.selectAll(".arc").attr("d", path)
        .attr("opacity", function(d) {
          return fade_at_edge(d)
        });
      svg.selectAll(".flyer")
        .attr("d", function(d) {
          return swoosh(flying_arc(d))
        })
        .attr("opacity", function(d) {
          return fade_at_edge(d)
        });
    }

    function showRoutes(){
        svg
          .selectAll(".line").attr("stroke", "rgba(153, 51, 51, 1");
    }
    function hideRoutes(){
        svg
          .selectAll(".line").attr("stroke", "rgba(153, 51, 51, 0");
    }

    function sizeChange() {
      width = window.innerWidth,
      height = window.innerHeight,
      offsetX = width / 1.1,
      offsetY = height / 2;

      radius = width / 3;
      if (height < width) {
      radius = height /1.3;
      }

      projection = d3 
        .geoOrthographic()
        .scale(radius)
        .rotate(currentPos)
        .translate([offsetX, offsetY])
        .clipAngle(90);

      d3.selectAll("ellipse")
        .attr("cx", offsetX - 40)
        .attr("cy", offsetY + radius - 20)
        .attr("rx", projection.scale() * 0.9)
        .attr("ry", projection.scale() * 0.25);

      d3.selectAll("circle")
        .attr("cx", offsetX)
        .attr("cy", offsetY)
        .attr("r", projection.scale());

      path = d3
        .geoPath()
        .projection(projection)
        .pointRadius(1.5);

      refresh();
    }
  </script>
</body>

</html>
