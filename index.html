<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Global Refugee Atlas</title>
  <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Hind+Siliguri&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap" rel="stylesheet">
  <link rel="shortcut icon" href="assets/img/nglogo.png" type="image/x-icon">
  <link href="css/perfect-scrollbar.css" rel="stylesheet">        
  <link href="https://fonts.googleapis.com/css?family=Buenard|Lustria|Vollkorn&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <style>
     html {
    -moz-osx-font-smoothing: grayscale;
    -webkit-font-smoothing: antialiased;
    font-weight: 400;
    font-weight: 300;
    }

    @-moz-document url-prefix() {
        body {
            font-weight: lighter !important;
        }
    }
    
    html,
    body{
      position: fixed;
      width: 100%;
      height: 100vh;
      margin: 0;
      background: rgba(82, 87, 96,0.7);
      color:white;
      overflow: hidden
    }

    svg{
      position: fixed;
    }

    .land {
      fill: rgb(255, 255, 255);
      stroke-opacity: 1;
    }

    .countries path {
      stroke: rgba(0, 0, 0, .2);
      stroke-linejoin: round;
      stroke-width: 1.5;
      fill-opacity: 1;
      stroke-dasharray: 4;
    }

    .countryTooltip {
      position: absolute;
      display: none;
      pointer-events: none;
      background: #fff;
      padding: 5px;
      text-align: left;
      border: solid #ccc 1px;
      color: #666;
      font-size: 14px;
      font-family: sans-serif;
      font-size:18px;
      font-family: 'Roboto Condensed', sans-serif !important;
    }

    .graticule {
      fill: none;
      stroke: black;
      stroke-width: .5;
      opacity: .2;
    }

    .labels {
      font-family: 'Roboto Condensed', sans-serif !important;
      fill: black;
      opacity: .5;
      font-weight:300;
    }

    .noclicks {
      pointer-events: none;
    }

    .point {
      opacity: 0.6; 
    }
    .line {
      stroke-linejoin: round;
      stroke-width: 2;
      fill-opacity: 0;
      stroke-dasharray:4;
    }

    .arcs {
      opacity: .1;
      stroke: gray;
      stroke-width: 3;
    }

    .flyers {
      stroke-width: 1;
      opacity: .6;
      stroke: darkred;
    }

    .arc,
    .flyer {
      stroke-linejoin: round;
      fill: none;
    }

    body{
        height:100%;
        width:100%;
    }
    
    div#but{
      width:420px;
      /*margin:auto;*/
    }

    div#but:hover{
        background: rgba(82, 87, 96,0.9);
    }

    div#but-text{
      position:relative;
      display:inline-block;
      left:120px;
      width:320px;
      margin-bottom:15px;
    }

    div.title{
        height:100%;
        display:block;
    }

    div#mainMenu{
        position:absolute;
        margin:auto;
        display:inline-block;
        width:500px;
        left:10px;
        top:25px;
        z-index:1000;
        height:100%;
        /*transform: translate(-50%, -50%);
        left: 50%;
        top: 50%;*/
    }
    
    div#text{
        height:95%;
        width:500px;
        position:relative;
        overflow: hidden;
        margin-left:20px;
    }

    h1{
      font-family: 'Roboto Condensed', sans-serif !important;
        font-variant: small-caps;
        font-weight:bold;
        font-size:115px;
        width:500px;
        text-align:left;
        line-height:125px;
        margin:auto;
        display:block;
        letter-spacing: 2px;
      }

    h2{
      font-family: 'Roboto Condensed', sans-serif !important;
        font-variant: small-caps;
        font-weight:bold;
        font-size:105px;
        width:500px;
        text-align:left;
        line-height:125px;
    }

    p{
      margin:0;
      font-family: 'Roboto Condensed', sans-serif !important;
    }

    p#but-a{
        font-size:34px;
        font-family: 'Roboto Condensed', sans-serif !important;
        font-variant: small-caps;
        border:none;
        text-decoration:none;
        color:white;
        text-align:left;
        font-weight:bold;
    }
    p#desc{
      font-family: 'Roboto Condensed', sans-serif !important;
      font-weight:300 !important;
      font-size:18px;
      color:white;
    }

    p:hover{
      text-decoration:none;
    }

    p.intro-text{
        font-weight:300;
        font-size:22px;
        width:400px;
        line-height:32px;
    }

    p.about-text{
        font-weight:300;
        font-size:18px;
        width:400px;
        line-height:24px;
    }

    p.cont-text{
      font-size:25px;
      font-weight:300;
    }

    img.icon{
      height:60px;
      width:60px;
      filter: invert(100%);
      display:inline-block;
      position:absolute;
      margin-top:20px;
      margin-left:10px;
    }
    a{
      color: white;
      font-weight:300;
      text-decoration:none;
      font-family: 'Roboto Condensed', sans-serif !important;
    }
    a:visited {
      color: white;
    }
    a:hover {
      color: white;
    }
    a.underlined{
      text-decoration:underline;
    }
    ul.a {
      list-style-type: circle;
    }
    ul.b {
      list-style-type: square;
    }
    li{
      font-size:24px;
      font-weight:300;
    }
    li.b{
      font-size:18px;
      font-weight:300;
    }
    div.bottom-arrow{
        color: white;
        background: #61666E;
        width:500px;
        height:50px;
        position:absolute;
        bottom:0;
        left:0;
        z-index:1000;
    }
    i#arrow{
      margin-top:10px;
      font-size: 30px !important;
      left: 200px;
      position: absolute;
    }
    div.navBar{
      height:35px;
      width:100%;
      background:#525760;
      position:absolute;
      left:0;
      top:0;
      z-index:1000;
    }
    a.back{
      margin-left:10px;
      margin-top:3px;
      font-size:20px;
      font-weight:normal;
      position:absolute;
      letter-spacing: 1px;
      font-family: 'Roboto Condensed', sans-serif !important;
    }
    a.back:hover{
      cursor:pointer;
      color:lightgray;
      text-decoration:none;
    }

    a.home{
      text-align:center;
      margin-top:3px;
      font-size:20px;
      font-weight:bold;
      position:absolute;
      font-variant: small-caps;
      left:50%;
      font-family: 'Roboto Condensed', sans-serif !important;
    }
    a.home:hover{
      cursor:pointer;
      color:lightgray;
      text-decoration:none;
    }

  </style>
</head>

<body>
  <div class="row">
  <div id ="mainMenu" class="col-md-5">
      <div id = "text">
        <div style="margin-bottom:200px;">
            <h1>Global Refugee Atlas</h1><br><br>
            <p class="intro-text">The Global Refugee Atlas visualizes and narrates core experiences of the millions of refugees under the  United Nations High Commissioner for Refugees (UNHCR) mandate using remote sensing data, crowdsourced social media data as well as a host of datasets from UNHCR and other international humanitarian agencies.<br><br>Exploiting the availability of these datasets, the Atlas is built on an open geo-narrative platform to illuminate the contexts and conditions underlying refugee journeys and camps. </p>
        </div>
        <div style="margin-bottom:200px;">
          <h2>Chapters</h2>
          <a href="context.html">
            <div id="but">
              <img src="assets/img/sample_icon.png" class="icon">
              <div id="but-text">
                <p onmouseover="showGlobal()" onmouseout="hideGlobal()" style="display:block;" id="but-a">Context</p>
                <p id="desc">Factors that influence international <br>crises and cause forced migrations</p>
              </div>
            </div>
          </a> 
          <a href="journey_menu.html" >
            <div id="but">
              <img src="assets/img/sample_icon.png" class="icon">
              <div id="but-text">
                <p id="but-a" style="display:block;">Journeys</p>
                <p id="desc">Global and local scales <br> of refugee movements</p>
              </div>
            </div>
          </a>  
          <a href="camp_menu.html" >
            <div id="but">
              <img src="assets/img/sample_icon.png" class="icon">
              <div id="but-text">
                <p id="but-a" style="display:block;">Camps</p>
                <p id="desc">Extension and growth of refugee <br> camps through satellite imagery</p>
              </div>
            </div>
          </a>  
          <a href="aid_menu.html" >
              <div id="but">
                <img src="assets/img/sample_icon.png" class="icon">
                <div id="but-text">
                  <p id="but-a" style="display:block;">Aid</p>
                  <p id="desc">Participation to international <br>agreements and UNHCR budget</p>
                </div>
              </div>
            </a>  
          <a href="tweets/index.html" >
            <div id="but">
              <img src="assets/img/sample_icon.png" class="icon">
              <div id="but-text">
                <p id="but-a" style="display:block;">Perception</p>
                <p id="desc">Perception on refugee issues <br>of social media users</p>
              </div>
            </div>
          </a>
          <br/><br/>
          <a href="sources.html">
            <div id="but">
              <img src="assets/img/sample_icon.png" class="icon">
              <div id="but-text">
                <p id="but-a" style="display:block;">Sources</p>
                <p id="desc">Data and software sources.</p>
              </div>
            </div>
          </a>
        </div>
        <div style="margin-bottom:200px;">
            <h2>About</h2>
            <p class="about-text">The Atlas is divided in five chapters that explore different aspects of the refugee experience, from the causes that generate international crises to the perception of social media users throghout the world.<br/><br/>The <i><a href="context.html" >Context</i></a> and <i><a href="aid_menu.html" >Aid </i></a>sections provide a visual foundation to understand the global scale of refugee movements as well as the context (e.g., refugee flows, human and environmental conditions of hosting countries, spread of wars and civil conflicts) and geographic conditions that underpin refugee journeys. At the same time, they illustrate the response to the refugee crisis highlighting international participation (e.g., countries that are signatories to the 1951 Refugee Convention and the 1968 Protocol, contributions to UNHCR, etc.). <br/><br/>Refugee experiences are highlighted through the use of geo-narratives using as case studies two stories: refugees escaping the brutality of the Burundian civil war and Somali refugees trying to reach the Mediterranean shores (<i><a href="journey_menu.html" >Journeys</i></a> section). Refugee camps are shown in some detail through two case studies (Kutupalong and Zaatari), while the growth of major refugee camps is visualized using remote sensing satellite imagery (<i><a href="camp_menu.html" >Camps</i></a> section). Finally the perception and the attitude toward refugees is explored running text analyses on crowdsourced data from social media users (<i><a href="tweets/index.html" >Perception</i></a> section). 
            <br><br>
            If you have questions, please contact Bo Zhao at <a href="mailto:zhaobo@uw.edu">zhaobo@uw.edu</a>.</p>                           
        </div>
        <div style="margin-bottom:200px;">
            <h2>Contributors</h2>
            <p class="cont-text"><b>Bo Zhao</b>&nbsp&nbspPI, <br><i>Assistant Professor in GIScience and Cartography</i></p><br>
            <p class="cont-text"><b>Jamon Van Den Hoek</b>&nbsp&nbspCo-PI, <br><i>Assistant Professor in Remote Sensing</i></p><br>
            <p class="cont-text"><b>Jennifer Alix-Garcia</b>&nbsp&nbspCo-PI, <br> <i>Professor in Applied Economics</i></p><br>
            <p class="cont-text"><b>Giovanni Svevo</b><i>&nbsp&nbspLead Cartographer, Designer</i></p><br>
            <p class="cont-text"><b>Gareth Baldrica Franklin</b><i>&nbsp&nbspCartographer, Designer</i></p><br>
            <p class="cont-text"><b>Ginny Katz</b><i>&nbsp&nbspContributor</i></p>  <br><br><br>

            <p class="cont-text">This work has been made possible by a grant from the National Geographic Society's Committee for Research and Exploration. <br><br>Special thanks to Julia Jones and Erik Steiner for their valuable inputs.</p>
  
        </div>
    </div>
  </div> 
  <div class="bottom-arrow"><i id="arrow" class="animated zoomIn infinite fa fa-chevron-down arrow-chevron-down"></i></div>
  <div class="col-md-7">
    <svg>
        <defs>
          <radialGradient cx="75%" cy="25%" id="ocean_fill">
            <stop offset="5%" stop-color="#ddf" />
            <stop offset="100%" stop-color="#9ab" />
          </radialGradient>
          <radialGradient cx="75%" cy="25%" id="globe_highlight">
            <stop offset="5%" stop-color="#fff" stop-opacity="0.6" />
            <stop offset="100%" stop-color="#808080" stop-opacity="0.2" />
          </radialGradient>
          <radialGradient cx="50%" cy="40%" id="globe_shading">
            <stop offset="50%" stop-color="#ffffff" stop-opacity="0" />
            <stop offset="100%" stop-color="#808080" stop-opacity="0.3" />
          </radialGradient>
          <radialGradient cx="50%" cy="50%" id="drop_shadow">
            <stop offset="20%" stop-color="#000" stop-opacity="0.5" />
            <stop offset="100%" stop-color="#000" stop-opacity="0" />
          </radialGradient>
        </defs>
      </svg>
  </div>  
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <!-- Use d3-fetch instead of d3-request in ES6 -->
  <script src="https://d3js.org/d3-request.v1.min.js"></script>
  <script src="https://d3js.org/d3-queue.v3.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src="js/perfect-scrollbar.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

  <script>
     d3.select(window).on("resize", sizeChange);

    const config = {
      speed: 0.001,
      verticalTilt: -30,
      horizontalTilt: 0
    };

    const ps = new PerfectScrollbar('#text', {
      wheelSpeed: .5,
      wheelPropagation: true,
      minScrollbarLength: 20
    });

    var width = window.innerWidth,
      height = window.innerHeight,
      sensitivity = 0.25,
      offsetX = width / 1.1,
      offsetY = height / 2,
      maxElevation = 45,
      initRotation = [0, -30],
      scaleExtent = [1, 2],
      flyerAltitude = 80,
      countryTooltip = d3.select("body").append("div").attr("class", "countryTooltip"),
      countryById = {},
      colorById = {},
      countries,
      countryCentroids = {},
      proj = 0,
      currentPos = initRotation;

    var radius = width / 3;
    if (height < width) {
      radius = height /1.3;
    }

    var projection = d3
      .geoOrthographic()
      .scale(radius)
      .rotate(initRotation)
      .translate([offsetX, offsetY])
      .clipAngle(90);
    var skyProjection = d3
      .geoOrthographic()
      .scale(radius + flyerAltitude)
      .rotate(initRotation)
      .translate([offsetX, offsetY])
      .clipAngle(90);
    var path = d3
      .geoPath()
      .projection(projection)
      .pointRadius(10.5);
    var swoosh = d3.line()
      .x(function(d) {
        return d[0]
      })
      .y(function(d) {
        return d[1]
      })
      .curve(d3.curveBasis);
    var graticule = d3.geoGraticule();

    var svg = d3
      .select("svg")
      .attr("width", width)
      .attr("height", height)
      .attr("transform-origin", offsetX + "px " + offsetY + "px")
      .call(
        d3
        .drag()
        .subject(function() {
          var r = projection.rotate();
          return {
            x: r[0] / sensitivity,
            y: -r[1] / sensitivity
          };
        })
        .on("drag", dragged)
      )
      /*.call(
        d3
        .zoom()
        .scaleExtent(scaleExtent)
        .on("zoom", zoomed)
      )*/
      .on("dblclick.zoom", null);

    var labels;

    d3.queue()
      .defer(d3.json, "https://raw.githubusercontent.com/d3/d3.github.com/master/world-110m.v1.json")
      .defer(d3.json, "assets/map_data/global/cities.json")
      .defer(d3.json, "assets/map_data/global/links.json")
      .defer(d3.csv, "assets/map_data/global/country_names.csv")
      .defer(d3.csv, "assets/map_data/global/demographics.csv")
      .defer(d3.json, "assets/map_data/global/camps.json")
      .defer(d3.json, "assets/map_data/global/settlements.json")
      .defer(d3.json, "assets/map_data/global/dispersed.json")
      .defer(d3.json, "assets/map_data/global/routes.json")
      .defer(d3.csv, "assets/map_data/global/country_color.csv")
      .await(ready);

function ready(error, world, places, links, countryNames, demographics, camps, settlements, dispersed, routes, color) {

      
var defs = svg.append("defs");

var filter = svg.append("defs")
  .append("filter")
  .attr("id", "drop-shadow")
  .attr("height", "110%");
filter.append("feGaussianBlur")
  .attr("in", "SourceAlpha")
  .attr("stdDeviation", 0.5)
  .attr("result", "blur");

filter.append("feOffset")
  .attr("in", "blur")
  .attr("dx", 1)
  .attr("dy", 1)
  .attr("result", "offsetBlur");

  var feMerge = filter.append("feMerge");

feMerge.append("feMergeNode")
    .attr("in", "offsetBlur")
feMerge.append("feMergeNode")
    .attr("in", "SourceGraphic");
    
var gradient = svg.append("svg:defs")
  .append("svg:linearGradient")
    .attr("id", "gradient")
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "0%")
    .attr("y2", "100%")
    .attr("spreadMethod", "pad");

gradient.append("svg:stop")
    .attr("offset", "0%")
    .attr("stop-color", "#d9d9d9")
    .attr("stop-opacity", 1);

gradient.append("svg:stop")
    .attr("offset", "100%")
    .attr("stop-color", "#b3b3b3")
    .attr("stop-opacity", 1);

  countries = topojson.feature(world, world.objects.countries).features;

  countryNames.forEach(function(d) {
    countryById[d.iso_n3] = d.name;
  });

  color.forEach(function(d) {
    colorById[d.iso_n3] = d.mapcolor8;
  });

  svg
    .append("ellipse")
    .attr("cx", offsetX - 40)
    .attr("cy", offsetY + radius - 20)
    .attr("rx", projection.scale() * 0.9)
    .attr("ry", projection.scale() * 0.25)
    .attr("class", "noclicks")
    .style("fill", "url(#drop_shadow)");
  svg
    .append("circle")
    .attr("cx", offsetX)
    .attr("cy", offsetY)
    .attr("r", projection.scale())
    .attr("class", "noclicks")
    .style("fill", "#ffffff");
  svg
    .append("path")
    .datum(topojson.feature(world, world.objects.land))
    .attr("class", "land")
    .attr("d", path)
    .style("filter", "url(#drop-shadow)");
  svg
    .append("path")
    .datum(graticule)
    .attr("class", "graticule noclicks")
    .attr("d", path);
  svg
    .append("circle")
    .attr("cx", offsetX)
    .attr("cy", offsetY)
    .attr("r", projection.scale())
    .attr("class", "noclicks")
    .style("fill", "url(#globe_highlight)");
  svg
    .append("circle")
    .attr("cx", offsetX)
    .attr("cy", offsetY)
    .attr("r", projection.scale())
    .attr("class", "noclicks")
    .style("fill", "url(#globe_shading)");
  svg
    .append("g")
    .attr("class", "countries")
    .selectAll("path")
    .data(countries, function(d){
            countryCentroids[d.id] = d3.geoCentroid(d);
        })
    .enter()
    .append("path")
    .attr("d", path)
    .attr("class", "country")
    .attr("name",function(d){
       return countryById[d.id];
    })
    .attr("fill", function (d) {
        return '#c8cad0';
    })
    .attr("box-shadow", 'inset 0 0 10px #000000');
  svg
    .append("g")
    .attr("class", "points")
    .selectAll(".point")
    .data(places.features)
    .enter()
    .append("path")
    .attr("class", "point")
    .attr("opacity", 0.6)
    .attr("d", path.pointRadius(10.5));
  svg
    .append("g")
    .attr("class", "labels")
    .selectAll(".label")
    .data(places.features)
    .enter()
    .append("text")
    .attr("class", "label")
    .text(function(d) {
      return d.properties.NAME;
    });
enableRotation();

  position_labels();

      svg
        .append("g")
        .attr("class", "points camps")
        .selectAll(".points")
        .data(camps.features)
        .enter()
        .append("path")
        .attr("class", "point1")
        .attr("opacity", .7)
        .attr("fill", "#DC143C")
        .attr("d", path.pointRadius(7));
      svg
        .append("g")
        .attr("class", "points settlements")
        .selectAll(".points")
        .data(settlements.features)
        .enter()
        .append("path")
        .attr("class", "point1")
        .attr("opacity", .5)
        .attr("fill", "#D2691E")
        .attr("d", path.pointRadius(5));
      svg
        .append("g")
        .attr("class", "points dispersed")
        .selectAll(".points")
        .data(dispersed.features)
        .enter()
        .append("path")
        .attr("class", "point1")
        .attr("fill", "	#E9967A")
        .attr("opacity", .5)
        .attr("d", path.pointRadius(2));

      svg
        .append("g")
        .attr("class", "lines")
        .selectAll(".lines")
        .data(routes.features)
        .enter()
        .append("path")
        .attr("d", path)
        .attr("class", "line")
        .attr("stroke", "rgba(153, 51, 51, 1)");
        
}
    
    function enableRotation() {
      d3.timer(function(elapsed) {
        projection.rotate([config.speed * elapsed - 110, config.verticalTilt, config.horizontalTilt- 30]);
        svg.selectAll("path").attr("d", path);
         position_labels();
      });
    }

    function endRotation() {
      svg.selectAll("path").attr("d", path);
    }

    function position_labels() {
      var centerPos = projection.invert([offsetX, offsetY]);
      svg
        .selectAll(".label")
        .attr("text-anchor", function(d) {
          var x = projection(d.geometry.coordinates)[0];
          return x < offsetX - 20 ? "end" : x < offsetX + 20 ? "middle" : "start";
        })
        .attr("transform", function(d) {
          var loc = projection(d.geometry.coordinates),
            x = loc[0],
            y = loc[1];
          var offset = x < offsetX ? -5 : 5;
          return "translate(" + (x + offset) + "," + (y - 2) + ")";
        })
        .style("display", function(d) {
          var d = d3.geoDistance(d.geometry.coordinates, centerPos);
          return d > 1.57 ? "none" : "inline";
        });
    }

    function flying_arc(pts) {
      var source = pts.geometry.coordinates[0],
        target = pts.geometry.coordinates[1];
      var mid1 = location_along_arc(source, target, .333);
      var mid2 = location_along_arc(source, target, .667);
      var result = [projection(source),
        skyProjection(mid1),
        skyProjection(mid2),
        projection(target)
      ]
      // console.log(result);
      return result;
    }

    function fade_at_edge(d) {
      var centerPos = projection.invert([offsetX, offsetY]);
      start = d.geometry.coordinates[0];
      end = d.geometry.coordinates[1];
      var start_dist = 1.57 - d3.geoDistance(start, centerPos),
        end_dist = 1.57 - d3.geoDistance(end, centerPos);
      var fade = d3.scaleLinear().domain([-.1, 0]).range([0, .1])
      var dist = start_dist < end_dist ? start_dist : end_dist;
      return fade(dist)
    }

    function location_along_arc(start, end, loc) {
      var interpolator = d3.geoInterpolate(start, end);
      return interpolator(loc)
    }

    function dragged() {
      var o1 = [d3.event.x * sensitivity, -d3.event.y * sensitivity];
      o1[1] =
        o1[1] > maxElevation ?
        maxElevation :
        o1[1] < -maxElevation ?
        -maxElevation :
        o1[1];
      currentPos = o1;
      projection.rotate(o1);
      skyProjection.rotate(o1);
      refresh();
    }

    function zoomed() {
      if (d3.event) {
        svg.attr("transform", "scale(" + d3.event.transform.k + ")");
      }
    }

    function refresh() {
      svg.selectAll(".land").attr("d", path);
      svg.selectAll(".countries path").attr("d", path);
      svg.selectAll(".graticule").attr("d", path);
      refreshLandmarks();
      refreshFlyers();
    }

    function refreshLandmarks() {
      svg.selectAll(".point").attr("d", path);
      svg.selectAll(".point1").attr("d", path);
      svg.selectAll(".line").attr("d", path);
      position_labels();
    }

    function refreshFlyers() {
      svg.selectAll(".arc").attr("d", path)
        .attr("opacity", function(d) {
          return fade_at_edge(d)
        });
      svg.selectAll(".flyer")
        .attr("d", function(d) {
          return swoosh(flying_arc(d))
        })
        .attr("opacity", function(d) {
          return fade_at_edge(d)
        });
    }

    function showGlobal(){
       /* svg
          .selectAll(".country").attr("fill", "#53c653");*/
    }
    function hideGlobal(){
        /*svg
          .selectAll(".country").attr("fill", function (d) {
          return colorRange(parseFloat(colorById[d.id]));
        })*/
    }

    function showRoutes(){
        svg
          .selectAll(".line")
          .attr("stroke", "rgba(153, 51, 51, 1)");
    }
    function hideRoutes(){
        svg
        .selectAll(".line")
        .attr("stroke", "rgba(153, 51, 51, 0)");
    }

    function showCamps(){
        svg
          .selectAll(".point1").style("opacity", 0.6);
    }
    function hideCamps(){
        svg
          .selectAll(".point1").style("opacity", 0);
    }

    function sizeChange() {
      width = window.innerWidth,
      height = window.innerHeight,
      offsetX = width / 1.1,
      offsetY = height / 2;

      radius = width / 3;
      if (height < width) {
      radius = height /1.3;
      }

      projection = d3 
        .geoOrthographic()
        .scale(radius)
        .rotate(currentPos)
        .translate([offsetX, offsetY])
        .clipAngle(90);

      d3.selectAll("ellipse")
        .attr("cx", offsetX - 40)
        .attr("cy", offsetY + radius - 20)
        .attr("rx", projection.scale() * 0.9)
        .attr("ry", projection.scale() * 0.25);

      d3.selectAll("circle")
        .attr("cx", offsetX)
        .attr("cy", offsetY)
        .attr("r", projection.scale());

      path = d3
        .geoPath()
        .projection(projection)
        .pointRadius(1.5);

      refresh();
    }

  </script>
</body>

</html>
